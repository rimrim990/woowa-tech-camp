# 친절한 SQL 튜닝 (개발자를 위한 SQL 튜닝 입문서)

## 2장. 인덱스 기본

### 인덱스 구조 및 탐색

**DBMS 가 데이터를 찾는 방법**
- 테이블 전체를 스캔한다.
- 인덱스를 이용한다.
  - 인덱스와 관련해서는 튜닝 요소가 매우 많고 기법도 다양함

**인덱스 튜닝의 핵심 요소**
- 인덱스는 큰 테이블에서 소량 데이터를 검색할 때 사용한다.
- 인데스 스캔 과정에서 발생하는 비효율을 줄이는 것이다.
  - ex) 학생명부 인덱스를 탐색할 때, 인덱스가 `(시력, 이름순)` 으로 구성될 때와 `(이름순, 시력)` 으로 구성될 때, 범위 스캔해야 할 양이 달라짐
- 테이블 액세스로 인한 랜덤 액세스를 줄여야 한다.
  - 랜덤 액세스를 최소화하는 것이 가장 주용함
  - SQL 튜닝은 랜덤 I/O 와의 전쟁

**랜덤 I/O**
- 데이터베이스 성능이 느린 이유는 디스크 I/O 때문이다.
  디스크 접근 시간은 `rotational latency`, `seek time`, `transfer time` 에 의해 좌우된다.
  - 탐색 시간 (seek time) - 실린더에 헤드를 위치 시키는 시간
  - 회전 지연 시간 (rotational latency) - 헤드가 트랙 내에서 원하는 섹터까지 회전하는 시간
  - 전송 시간 (transfer time) - 원하는 섹터를 읽는데 걸리는 시간
- 랜덤 I/O 는 데이터가 물리적으로 불연속적으로 있기 때문에 디스크 헤더를 이동 시킨 다음 데이터를 읽어야 하기 때문에 오래 걸린다.
  - 디스크 헤더는 기계적으로 이동하기 때문에 느림

**인덱스 구조**
- 인덱스는 대용량 테이블에서 필요한 데이터만 빠르게 효율적으로 액세스하기 위해 사용하는 오브젝트이다.
- 인덱스 없이 데이터를 검색하려면 테이블을 처음부터 끝끼지 모두 읽어야 한다 (테이블 풀 스캔)
- 인덱스를 이용하면 일부만 읽고 멈출 수 있다. 즉, 범위 스캔이 가능하다.
  - 범위 스캔이 가능한 이유는 인덱스가 정렬돼 있기 때문
- DBMS 는 일반적으로 B 트리 인덱스를 사용한다.
  - 루트와 브랜치 블록에 있는 각 레코드는 하위 블록에 대한 주소값을 갖음
  - 리프 블록에 저장된 각 레코드는 키 값으로 정렬, 테이블 레코드를 가리키는 주소값을 저장
  - 루트로부터 모든 리프 블록까지의 높이는 항상 같음

**인덱스 탐색 과정**
- 수직적 탐색은 인덱스 스캔 시작지점을 찾는 과정이다.
  - 루트에서 시작하여 리프 블록까지 탐색
- 수평적 탐색은 스캔 시작점부터 찾고자 하는 데이터가 나타나지 않을 때까지 인덱스 리프 블록을 탐색하는 것이다.