# 친절한 SQL 튜닝 (개발자를 위한 SQL 튜닝 입문서)

## 2장. 인덱스 기본

### 인덱스 확장기능 사용법

### Index Range Scan
- `B트리` 인덱스의 가장 일반적이고 정상적인 형태의 액세스이다.
- 인덱스 루트에서 리프 블록까지 수직적으로 탐색한 후에 '필요한 범위만' 스캔한다.
- 인덱스를 `Range Scan` 하려면 선두 컬럼을 가공하지 않은 상태로 조건 절에 사용해야 한다.
- 인덱스를 탄다고 성능이 좋은 것은 아니다.
  - 성능은 인덱스 스캔 범위, 테이블 액세스 횟수를 얼마나 줄이냐로 결정됨

### Index Full Scan
- 수직적 탐색 없이 인덱스 리프 블록을 처음부터 끝까지 수평적으로 탐색하는 방식이다.
  - 대개 데이터 검색을 위한 최적의 인덱스가 없을 때 차선으로 선택
- 선두 컬럼이 조건절에 없으면 옵티마이저는 먼저 Table Full Scan 을 고려한다.
  - 테이블의 용량이 너무 커 Table Full Scan 에 부담이 크다면 인덱스 활용을 다시 고려할 수 밖에 없음
  - 인덱스가 차지하는 면적은 테이블보다 훨씬 작음
- 인덱스 스캔 단계에서 대부분 레코드는 필터링하고 아주 일부 테이블만 액세스 하는 상황이라면, 면적이 큰 테이블보다 인덱스를 스캔하는 게 유리하다.
  - 수행빈도가 낮은 SQL 이면 상관 없지만, 그렇지 않다면 조회하는 컬럼이 선두인 인덱스를 생성해주는 것이 좋음
- `Sort Order By` 연산을 생략하기 위한 목적으로 사용할 수도 있다.
  - 이때는 차선책이 아니라 옵티마이저가 전략적으로 선택한 경우

### Index Unique Scan
- 수직적 탐색만으로 데이터를 찾는 스캔 방식으로서, 유니크 인덱스를 동등 조건으로 탐색하는 경우에만 작동한다.
- 유니크 인덱스가 존재하는 컬럼은 중복 값이 입력되지 않게 DBMS 가 데이터 정합성 관리한다.
  - 동등 조건으로 검색하면 데이터 한 건만 찾으면 탐색 종료

### Index Skip Scan
- 조건절에 빠진 인덱스 선두 컬럼의 `Distinct Value` 개수가 적고 후행 컬럼의 `Distinct Value` 개수가 많을 때 유용하다.
- Index Skip Scan 은 루트 또는 브랜치 블록에서 읽은 컬럼 값 정보를 이용해 조건절에 부합하는 레코드를 포함할 '가능성이 있는' 리프 블록만 골라서 액세스하는 스캔 방식이다.
- Index Range Scan 이 불가능하거나 효율적이지 못한 상황에서 Index Skip Scan 이 종종 빛을 발한다.
- 인덱스는 기본적으로 Index Range Scan 을 목표로 설계해야 하며, 수행 횟수가 적은 SQL 을 위해 인덱스를 추가하는 것이 비효율적일 때 이들 스캔 방식을 차선책으로 활용하는 것이 바람직하다.